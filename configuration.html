<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configuration &mdash; pyramid_oereb  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Changes/Hints for migration" href="changes.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> pyramid_oereb
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#add-additional-topics">Add additional topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-an-oereblex-topic">Add an oereblex topic</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adapt-existing-models">Adapt existing models</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-custom-sources">Create custom sources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">Changes/Hints for migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="standard/index.html">Standard</a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib/index.html">Contribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="core/index.html">Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyramid_oereb</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Configuration</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="configuration">
<span id="id1"></span><h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h1>
<p>You are looking at a highly configurable piece of software. To get the right understanding of the server it
is recommended to read this part carefully.</p>
<p>Since the swiss confederation’s definition and the specification for the <a class="reference external" href="https://www.cadastre.ch/content/cadastre-internet/de/manual-oereb/publication/publication.download/cadastre-internet/de/documents/oereb-weisungen/OEREB-Data-Extract_de.pdf">OEREB Data Extract</a> is really straight,
we had very narrow margins to develop the code. Using this pyramid plugin, you will get a running server
providing the services to satisfy the federal specification. But to get this extract, you need to bind your
data to this server. And this is basically what you need to configure.</p>
<p>This section describes the different possibilities to adapt the application on different data structures or
even custom data sources. If you are planning to use such modifications, we suggest to check all possible
solutions first, as the necessary effort can vary significantly depending on your specific needs.</p>
<section id="add-additional-topics">
<span id="configuration-additional-topics"></span><h2>Add additional topics<a class="headerlink" href="#add-additional-topics" title="Permalink to this headline">¶</a></h2>
<p>If you only need to add one or more additional cantonal topics and want to use the standard database structure
for these too, you can run a provided script to generate the required models.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>create_standard_model<span class="w"> </span>-c<span class="w"> </span>&lt;YOUR_NEW_TOPIC_CODE&gt;<span class="w"> </span>-g<span class="w"> </span>&lt;GEOMETRY_TYPE&gt;<span class="w"> </span>-p<span class="w"> </span>&lt;TARGET_PATH&gt;<span class="w"> </span>-k<span class="w"> </span>TRUE
</pre></div>
</div>
<p>The first parameter is the code of your new topic and has to be defined in camelcase. The geometry type for
the theme can be one of the following:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>POINT</cite>,</p></li>
<li><p><cite>LINESTRING</cite>,</p></li>
<li><p><cite>POLYGON</cite></p></li>
<li><p><cite>MULTIPOINT</cite></p></li>
<li><p><cite>MULTILINESTRING</cite></p></li>
<li><p><cite>MULTIPOLYGON</cite> or</p></li>
<li><p><cite>GEOMETRYCOLLECTION</cite>.</p></li>
</ul>
</div></blockquote>
<p>The geometry collection is only meant for topics that can consist of different geometry types. We <strong>strongly</strong>
recommend to use it <strong>only if a simple geometry cannot be used</strong> and to put <strong>only one geometry</strong> in each
record. Do not use it as a bucket for everything! The third parameter defines the output directory in which
the new file will be created, e.g. a module directory of your application.</p>
<p>To use strings as primary key type, add the ‘-k TRUE’ parameter. If not supplied, the default primary key type
of integer will be used instead.</p>
<p>After creating the models you have to create its configuration. Open the configuration file
(pyramid_oereb_standard.yml) and copy the section from one of the existing topics which usually looks like
this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">code</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ch.BaulinienNationalstrassen</span>
<span class="w">  </span><span class="nt">geometry_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LINESTRING</span>
<span class="w">  </span><span class="nt">thresholds</span><span class="p">:</span>
<span class="w">    </span><span class="nt">length</span><span class="p">:</span>
<span class="w">      </span><span class="nt">limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">      </span><span class="nt">unit</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;m&#39;</span>
<span class="w">      </span><span class="nt">precision</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">area</span><span class="p">:</span>
<span class="w">      </span><span class="nt">limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">      </span><span class="nt">unit</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;m2&#39;</span>
<span class="w">      </span><span class="nt">precision</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">percentage</span><span class="p">:</span>
<span class="w">      </span><span class="nt">precision</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">text</span><span class="p">:</span>
<span class="w">    </span><span class="nt">de</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Baulinien Nationalstrassen</span>
<span class="w">  </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">de</span>
<span class="w">  </span><span class="nt">federal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">standard</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">source</span><span class="p">:</span>
<span class="w">    </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pyramid_oereb.lib.sources.plr.DatabaseSource</span>
<span class="w">    </span><span class="nt">params</span><span class="p">:</span>
<span class="w">      </span><span class="nt">db_connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://postgres:password@localhost:5432/pyramid_oereb</span>
<span class="w">      </span><span class="nt">models</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pyramid_oereb.standard.models.motorways_building_lines</span>
<span class="w">  </span><span class="nt">get_symbol_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pyramid_oereb.standard.methods.get_symbol</span>
</pre></div>
</div>
<p>Apply the necessary modifications for the new topic. This should at least be the the name, code and text
definitions and of course the models property within the source parameters. It should point to the module
with the generated models of the former step.</p>
<p>Now you have set up an empty additional topic and you can continued with deploying your data into it.</p>
</section>
<section id="add-an-oereblex-topic">
<h2>Add an oereblex topic<a class="headerlink" href="#add-an-oereblex-topic" title="Permalink to this headline">¶</a></h2>
<p>If you want to use oereblex for a topic, you can proceed as described in the previous section,
but using a different script to generate the required models.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>create_oereblex_model<span class="w"> </span>-c<span class="w"> </span>&lt;YOUR_NEW_TOPIC_CODE&gt;<span class="w"> </span>-g<span class="w"> </span>&lt;GEOMETRY_TYPE&gt;<span class="w"> </span>-p<span class="w"> </span>&lt;TARGET_PATH&gt;<span class="w"> </span>-k<span class="w"> </span>TRUE
</pre></div>
</div>
</section>
<section id="adapt-existing-models">
<span id="configuration-adapt-models"></span><h2>Adapt existing models<a class="headerlink" href="#adapt-existing-models" title="Permalink to this headline">¶</a></h2>
<p>Another option to modify the standard configuration, is to adapt the existing models to fit another database
structure. This method is recommended if you are using an existing database supported by GeoAlchemy 2 and
already containing all the necessary data but in a different structure. In this case you should check, if it
is possible to transform the data by extending the existing models with a mapping to fit your structure.</p>
<p>The easiest example is a simple mapping of table and column names, if you use a different language. Using the
possibilities of SQLAlchemy, you could extend the existing
<span class="xref std std-ref">api-pyramid_oereb-standard-models-motorways_building_lines-office</span> like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid_oereb.lib.standard.models</span> <span class="kn">import</span> <span class="n">motorways_building_lines</span>

<span class="k">class</span> <span class="nc">Office</span><span class="p">(</span><span class="n">motorways_building_lines</span><span class="o">.</span><span class="n">Office</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The bucket to fill in all the offices you need to reference from public law restriction,</span>
<span class="sd">    document, geometry.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (int): The identifier. This is used in the database only and must not be set manually.</span>
<span class="sd">            If you don&#39;t like it - don&#39;t care about.</span>
<span class="sd">        name (dict): The multilingual name of the office.</span>
<span class="sd">        office_at_web (str): A web accessible url to a presentation of this office.</span>
<span class="sd">        uid (str): The uid of this office from https</span>
<span class="sd">        line1 (str): The first address line for this office.</span>
<span class="sd">        line2 (str): The second address line for this office.</span>
<span class="sd">        street (str): The streets name of the offices address.</span>
<span class="sd">        number (str): The number on street.</span>
<span class="sd">        postal_code (int): The ZIP-code.</span>
<span class="sd">        city (str): The name of the city.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="s1">&#39;baulinien_nationalstrassen&#39;</span><span class="p">}</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;amt&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;oid&#39;</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">office_at_web</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;amt_im_web&#39;</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">line1</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;zeile1&#39;</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">line2</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;zeile2&#39;</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">street</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;strasse&#39;</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;hausnr&#39;</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">postal_code</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;plz&#39;</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;ort&#39;</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>The only thing, you have to care about, if you want to stay using the standard sources, is to keep the class
name, the names of the properties and their data types.</p>
<p>After extending the models, do not forget to change the models module in the configuration of the topic’s
source.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plr88</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">code</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ch.BaulinienNationalstrassen</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">(...)</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">source</span><span class="p p-Indicator">:</span>
<span class="w">      </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pyramid_oereb.lib.sources.plr.DatabaseSource</span>
<span class="w">      </span><span class="nt">params</span><span class="p">:</span>
<span class="w">        </span><span class="nt">db_connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://postgres:password@localhost:5432/pyramid_oereb</span>
<span class="w">        </span><span class="nt">models</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_application.models.motorways_building_lines</span>
<span class="w">  </span><span class="w w-Error">  </span><span class="nt">get_symbol_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pyramid_oereb.standard.methods.get_symbol</span>
</pre></div>
</div>
</section>
<section id="create-custom-sources">
<span id="configuration-create-sources"></span><h2>Create custom sources<a class="headerlink" href="#create-custom-sources" title="Permalink to this headline">¶</a></h2>
<p>If the possibilities described above do not fit your needs, you can implement your own sources. This is the
only possible way, if their are no existing sources available to access your data. For example, this could be
the case, if you are trying to access a kind of file system or some other proprietary data source.</p>
<p>As for the models, basically every source can be replaced using the configuration. In the configuration, every
source is defined by a <cite>class</cite> property, pointing on the class that should be used to instantiate it, and a
<cite>params</cite> property containing keyword arguments passed to its constructor.</p>
<p>For example, the real estate source for the standard database is configured with two parameters, the database
connection and the model class, which looks like the following.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">real_estate</span><span class="p">:</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">(...)</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">source</span><span class="p p-Indicator">:</span>
<span class="w">    </span><span class="c1"># The source must have a class which represents the accessor to the source. In this case it</span>
<span class="w">    </span><span class="c1"># is a source already implemented which reads data from a database.</span>
<span class="w">    </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pyramid_oereb.lib.sources.real_estate.DatabaseSource</span>
<span class="w">    </span><span class="c1"># The configured class accepts params which are also necessary to define</span>
<span class="w">    </span><span class="nt">params</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># The connection path where the database can be found</span>
<span class="w">      </span><span class="nt">db_connection</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;postgresql://postgres:password@localhost:5432/pyramid_oereb&quot;</span>
<span class="w">      </span><span class="c1"># The model which maps the real estate database table.</span>
<span class="w">      </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pyramid_oereb.standard.models.main.RealEstate</span>
</pre></div>
</div>
<p>You can use the base source and extend it to create your own customized source implementations. With the
parameters passed as keyword arguments, you are free to pass as many arguments you need. There are only two
restrictions on implementing a custom source:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>The source has to implement the method <cite>read()</cite> with the arguments used in its base source. For
example, your custom real estate source has to accept the arguments defined in
<span class="xref std std-ref">api-pyramid_oereb-lib-sources-real_estate-realestatebasesource</span>.</p></li>
<li><p>The method <cite>read()</cite> has to add records of the corresponding type to the source’ records list. Every
source has list property called <cite>records</cite>. In case of a real estate source, the method <cite>read()</cite> has to
create one or more instances of the <span class="xref std std-ref">api-pyramid_oereb-lib-records-real_estate-realestaterecord</span>
and add them to this list.</p></li>
</ol>
</div></blockquote>
<p>This way, you should be able to create sources for nearly every possible data source.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Implementing a custom source for public law restrictions, requires to create public law restriction
records with all referenced records of other classes according to the <a class="reference external" href="https://www.cadastre.ch/content/cadastre-internet/de/manual-oereb/publication/publication.download/cadastre-internet/de/documents/oereb-weisungen/OEREB-Data-Extract_de.pdf">OEREB Data Extract</a> model (page 5).</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="changes.html" class="btn btn-neutral float-right" title="Changes/Hints for migration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2022, openoereb community.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>